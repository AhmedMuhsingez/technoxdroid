---
import BaseLayout from '@/layouts/BaseLayout'
import ListPosts from '@/components/ListPosts'
import ListCategories from '@/components/ListCategories'
import TitlePage from '@/components/TitlePage'
import Pagination from '@/components/Pagination'
import { fetchArticles, fetchCategories } from 'src/utils/fetchApiData'

const categoriesData = await fetchCategories()
const currentCategory =
	categoriesData.data.find((category) => category.attributes.slug === Astro.params.category)
		?.attributes.name || ''

const page = Astro.url.searchParams.get('page')
let currentPage = page ? Number(page) : 1

const articles = await fetchArticles(currentPage, 5, 'createdAt:desc', Astro.params.category)
const articlesData = articles.data.map((article) => {
	return article
})

const pagination = articles.meta.pagination
---

<BaseLayout title={currentCategory}>
	<TitlePage title={currentCategory} />
	<ListCategories categoriesData={categoriesData} />
	<ListPosts articles={articlesData} />
	<Pagination isCategory={true} pagination={pagination} categorySlug={Astro.params.category} />
</BaseLayout>
