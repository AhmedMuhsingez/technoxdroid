---
import BlogPost from '@/layouts/BlogPost'
import fetchApi from 'src/lib/strapi'
import { marked } from 'marked'
import * as DOMPurify from 'dompurify'
import { Debug } from 'astro:components'
import Markdown from 'react-markdown'

const { slug } = Astro.params
let article: SingleArticleData
try {
	article = await fetchApi<SingleArticleData>({
		endpoint: 'articles/' + slug,
		query: {
			populate: '*'
		}
	})
} catch (error) {
	return Astro.redirect('/404')
}

const markdownBlock = marked(article.data.attributes.RichTextEditor)

// const markdownContent = markdownBlocks.map((res) => {
// 	// return DOMPurify.sanitize(marked.parse(res.body))
// 	const singleBlock = marked.parse(res.body.replace(/\n/gi, '<br />'))
// 	return singleBlock
// })
---

<>
	<BlogPost data={article.data.attributes}>
		<!-- <Markdown> -->
		<div set:html={markdownBlock} class='prose dark:prose-invert max-w-none' />
		<!-- {markdownBlock}
		</Markdown> -->
	</BlogPost>
	<!-- <Debug data={markdownBlock} /> -->
</>
