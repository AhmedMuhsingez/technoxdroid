---
import BlogPost from '@/layouts/BlogPost'
import fetchApi from 'src/lib/strapi'
import { marked } from 'marked'

const { slug } = Astro.params
let article: SingleArticleData

try {
	article = await fetchApi<SingleArticleData>({
		endpoint: 'articles/' + slug,
		query: {
			populate: '*'
		}
	})
} catch (error) {
	return Astro.redirect('/404')
}

const markdownBlock = marked(
	article.data.attributes.RichTextEditor !== null ? article.data.attributes.RichTextEditor : ''
)
---

<BlogPost data={article.data.attributes}>
	<div
		set:html={markdownBlock}
		class={`prose dark:prose-invert max-w-none prose-p:text-lg prose-img:m-auto prose-img:max-h-[720px] prose-blockquote:text-center`}
	/>
</BlogPost>
